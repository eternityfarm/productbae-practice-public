<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>동물상 테스트</title>
  <link href='/style.css' rel='stylesheet'>
</head>
<body>
  <div>Teachable Machine Image Model</div>
  <input type="file" id="image-upload" accept="image/*" />
  <div id="image-container">
    <img id="uploaded-image" width="200" height="200" />
  </div>
  <div id="label-container"></div>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <script type="text/javascript">
      // More API functions here:
      // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

      // the link to your model provided by Teachable Machine export panel
      const URL = "https://teachablemachine.withgoogle.com/models/UypRWo4Ql/";

      let model, labelContainer, maxPredictions;

      // Load the image model
      async function init() {
          const modelURL = URL + "model.json";
          const metadataURL = URL + "metadata.json";

          // load the model and metadata
          model = await tmImage.load(modelURL, metadataURL);
          maxPredictions = model.getTotalClasses();

          labelContainer = document.getElementById("label-container");
          for (let i = 0; i < maxPredictions; i++) { // and class labels
              labelContainer.appendChild(document.createElement("div"));
          }

          const imageUpload = document.getElementById("image-upload");
          imageUpload.addEventListener("change", async (e) => {
              const file = e.target.files[0];
              const reader = new FileReader();
              reader.onload = async (event) => {
                  const image = document.getElementById("uploaded-image");
                  image.src = event.target.result;
                  image.onload = async () => {
                      await predict(image);
                  }
              }
              reader.readAsDataURL(file);
          });
      }

      // run the image through the image model
      async function predict(image) {
          // predict can take in an image, video or canvas html element
          const prediction = await model.predict(image);
          for (let i = 0; i < maxPredictions; i++) {
              const classPrediction =
                  prediction[i].className + ": " + prediction[i].probability.toFixed(2);
              labelContainer.childNodes[i].innerHTML = classPrediction;
          }
      }

      init();
  </script>
</body>
</html>